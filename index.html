<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <title>Saulius Talks</title>

    <style>
        #container {
            width: 100%;
            max-width: 800px;
            margin: 0 auto;
        }

        .saulius-wrapper {
            padding: 20px;
            width: 100%;
            position: relative;
        }

        .bazinga {
            position: fixed;
            bottom: 0;
            left: 0;
            width: calc(100% - 40px);
            padding: 50px;
            font-size: 22px;
            -webkit-box-sizing: border-box;
            box-sizing: border-box;
            margin: 20px;
            text-transform: uppercase;
            background-color: lightblue;
            border: none;
            -webkit-transition: 0.25s all ease;
            -o-transition: 0.25s all ease;
            transition: 0.25s all ease;
        }

        .bazinga:hover {
            opacity: 0.8;
            background-color: #ead787;
        }

        .face {
            position: absolute;
            top: 0;
            left: 50%;
            -webkit-transition: 0.3s -webkit-transform ease-in-out;
            transition: 0.3s -webkit-transform ease-in-out;
            -o-transition: 0.3s transform ease-in-out;
            transition: 0.3s transform ease-in-out;
            transition: 0.3s transform ease-in-out, 0.3s -webkit-transform ease-in-out;
            -webkit-transform: translate(-50%, 0);
            -ms-transform: translate(-50%, 0);
            transform: translate(-50%, 0);
            -webkit-transform-origin: 50%;
            -ms-transform-origin: 50%;
            transform-origin: 50%;
        }

        .jaw.active {
            -webkit-transition: 0.3s -webkit-transform ease-in-out;
            transition: 0.3s -webkit-transform ease-in-out;
            -o-transition: 0.3s transform ease-in-out;
            transition: 0.3s transform ease-in-out;
            transition: 0.3s transform ease-in-out, 0.3s -webkit-transform ease-in-out;
            -webkit-transform: translate(-50%, -56px);
            -ms-transform: translate(-50%, -56px);
            transform: translate(-50%, -56px);
        }

        .jaw-copy-1,
        .jaw-copy-2,
        .jaw-copy-3,
        .jaw-copy-4,
        .jaw-copy-5,
        .jaw-copy-6,
        .jaw-copy-7,
        .jaw-copy-8,
        .jaw-copy-9,
        .jaw-copy-10,
        .jaw-copy-11,
        .jaw-copy-12 {
            -webkit-transform: translate(-49.7%, -9px);
            -ms-transform: translate(-49.7%, -9px);
            transform: translate(-49.7%, -9px);
            -webkit-transition: 0.18s -webkit-transform ease-in-out;
            transition: 0.18s -webkit-transform ease-in-out;
            -o-transition: 0.18s transform ease-in-out;
            transition: 0.18s transform ease-in-out;
            transition: 0.18s transform ease-in-out, 0.18s -webkit-transform ease-in-out;
        }

        /* .jaw-copy-1.active {
            -webkit-transform: translate(-50%, 10px);
            -ms-transform: translate(-50%, 10px);
            transform: translate(-50%, 10px);
        }

        .jaw-copy-2.active {
            -webkit-transform: translate(-50%, 20px);
            -ms-transform: translate(-50%, 20px);
            transform: translate(-50%, 20px);
        }

        .jaw-copy-3.active {
            -webkit-transform: translate(-50%, 30px);
            -ms-transform: translate(-50%, 30px);
            transform: translate(-50%, 30px);
        }

        .jaw-copy-4.active {
            -webkit-transform: translate(-50%, 35px);
            -ms-transform: translate(-50%, 35px);
            transform: translate(-50%, 35px);
        }

        .jaw-copy-5.active {
            -webkit-transform: translate(-50%, 38px);
            -ms-transform: translate(-50%, 38px);
            transform: translate(-50%, 38px);
        }

        .jaw-copy-6.active {
            -webkit-transform: translate(-50%, 40px);
            -ms-transform: translate(-50%, 40px);
            transform: translate(-50%, 40px);
        }

        .jaw-copy-7.active {
            -webkit-transform: translate(-50%, 5px);
            -ms-transform: translate(-50%, 5px);
            transform: translate(-50%, 5px);
        }

        .jaw-copy-8.active {
            -webkit-transform: translate(-50%, 25px);
            -ms-transform: translate(-50%, 25px);
            transform: translate(-50%, 25px);
        }

        .jaw-copy-9.active {
            -webkit-transform: translate(-50%, 28px);
            -ms-transform: translate(-50%, 28px);
            transform: translate(-50%, 28px);
        }

        .jaw-copy-10.active {
            -webkit-transform: translate(-50%, 32px);
            -ms-transform: translate(-50%, 32px);
            transform: translate(-50%, 32px);
        }

        .jaw-copy-11.active {
            -webkit-transform: translate(-50%, 36px);
            -ms-transform: translate(-50%, 36px);
            transform: translate(-50%, 36px);
        }

        .jaw-copy-12.active {
            -webkit-transform: translate(-50%, 40px);
            -ms-transform: translate(-50%, 40px);
            transform: translate(-50%, 40px);
        } */
    </style>
</head>

<body>

    <div id="container">
        <div class="saulius-wrapper">
            <img class="face full-face" src="full-face.png" alt="">
            <img class="face jaw-copy" src="jaw-copy.png" alt="">
            <img class="face jaw-copy jaw-copy-1" src="jaw-copy.png" alt="">
            <img class="face jaw-copy jaw-copy-2" src="jaw-copy.png" alt="">
            <img class="face jaw-copy jaw-copy-3" src="jaw-copy.png" alt="">
            <img class="face jaw-copy jaw-copy-4" src="jaw-copy.png" alt="">
            <img class="face jaw-copy jaw-copy-5" src="jaw-copy.png" alt="">
            <img class="face jaw-copy jaw-copy-6" src="jaw-copy.png" alt="">
            <img class="face jaw-copy jaw-copy-7" src="jaw-copy.png" alt="">
            <img class="face jaw-copy jaw-copy-8" src="jaw-copy.png" alt="">
            <img class="face jaw-copy jaw-copy-9" src="jaw-copy.png" alt="">
            <img class="face jaw-copy jaw-copy-10" src="jaw-copy.png" alt="">
            <img class="face jaw-copy jaw-copy-11" src="jaw-copy.png" alt="">
            <img class="face jaw-copy jaw-copy-12" src="jaw-copy.png" alt="">
            <img class="face mouth" src="mouth.png" alt="">
            <img class="face jaw active" src="jaw.png" alt="">
        </div>
        <button class="bazinga">How am I called?</button>
    </div>


    <script>


        var btn = document.querySelector('.bazinga');
        btn.addEventListener('click', function (e) {
            var audio = new Audio('saulius.m4a');
            audio.play();
        });

        // if (navigator.mediaDevices) {
        //     console.log('getUserMedia supported.');
        //     navigator.mediaDevices.getUserMedia({ audio: true, video: false })
        //         .then(function (stream) {
        //             var audioCtx = new AudioContext();
        //             var source = audioCtx.createMediaStreamSource(stream);
        //             console.log(source);
        //         });
        // }

        // var audioCtx = new (window.AudioContext || window.webkitAudioContext)();

        /*
     *  Copyright (c) 2015 The WebRTC project authors. All Rights Reserved.
     *
     *  Use of this source code is governed by a BSD-style license
     *  that can be found in the LICENSE file in the root of the source
     *  tree.
     */

        // 'use strict';

        // Meter class that generates a number correlated to audio volume.
        // The meter class itself displays nothing, but it makes the
        // instantaneous and time-decaying volumes available for inspection.
        // It also reports on the fraction of samples that were at or near
        // the top of the measurement range.
        function SoundMeter(context) {
            this.context = context;
            this.instant = 0.0;
            this.slow = 0.0;
            this.clip = 0.0;
            this.script = context.createScriptProcessor(2048, 1, 1);
            var that = this;
            this.script.onaudioprocess = function (event) {
                var input = event.inputBuffer.getChannelData(0);
                var i;
                var sum = 0.0;
                var clipcount = 0;
                for (i = 0; i < input.length; ++i) {
                    sum += input[i] * input[i];
                    if (Math.abs(input[i]) > 0.99) {
                        clipcount += 1;
                    }
                }
                that.instant = Math.sqrt(sum / input.length);
                that.slow = 0.95 * that.slow + 0.05 * that.instant;
                that.clip = clipcount / input.length;
            };
        }

        SoundMeter.prototype.connectToSource = function (stream, callback) {
            console.log('SoundMeter connecting');
            try {
                this.mic = this.context.createMediaStreamSource(stream);
                this.mic.connect(this.script);
                // necessary to make sample run, but should not be.
                this.script.connect(this.context.destination);
                if (typeof callback !== 'undefined') {
                    callback(null);
                }
            } catch (e) {
                console.error(e);
                if (typeof callback !== 'undefined') {
                    callback(e);
                }
            }
        };
        SoundMeter.prototype.stop = function () {
            this.mic.disconnect();
            this.script.disconnect();
        };


        /*
 *  Copyright (c) 2015 The WebRTC project authors. All Rights Reserved.
 *
 *  Use of this source code is governed by a BSD-style license
 *  that can be found in the LICENSE file in the root of the source
 *  tree.
 */

        /* global AudioContext, SoundMeter */


        var jawCopies = document.querySelectorAll('.jaw-copy');
        var jaw = document.querySelector('.jaw');

        try {
            window.AudioContext = window.AudioContext || window.webkitAudioContext;
            window.audioContext = new AudioContext();
        } catch (e) {
            alert('Web Audio API not supported.');
        }

        // Put variables in global scope to make them available to the browser console.
        var constraints = window.constraints = {
            audio: true,
            video: false
        };


        function handleSuccess(stream) {

            // Put variables in global scope to make them available to the
            // browser console.
            window.stream = stream;
            var soundMeter = window.soundMeter = new SoundMeter(window.audioContext);
            soundMeter.connectToSource(stream, function (e) {
                if (e) {
                    alert(e);
                    return;
                }
                setInterval(function () {

                        let volume = soundMeter.instant;
                        let partition, dividend;

                        if (volume > 0.01 && volume <= 0.07) {
                            volume = -56 + 9;
                            partition = 56 + volume;
                        } else if (volume > 0.07 && volume <= 0.15) {
                            volume = -56 + 15;
                            partition = 56 + volume;
                            // increase size of eyes a little

                        }else if (volume > 0.15 && volume <= 0.2) {
                            volume = -56 + 28;
                            partition = 56 + volume;
                            // increase size of eyes a little

                        } else if (volume > 0.2 && volume <= 0.3) {
                            volume = -56 + 40;
                            partition = 56 + volume;
                            // increase size of eyes a little

                        } else if (volume > 0.3 && volume <= 0.35) {
                            volume = -56 + 45;
                            partition = 56 + volume;
                            // increase size of eyes a little

                        }else if (volume > 0.35 && volume <= 0.4) {
                            volume = -56 + 50;
                            partition = 56 + volume;
                            // increase size of eyes a little

                        } else if (volume > 0.4) {
                            volume = -0.5;
                            partition = 56 + volume;
                            // add class to jaw to make it vibrate
                            // increase size of eyes a lot
                            // add class to eyes to make them vibrate
                        } else {
                            volume = -56;
                            partition = 0;
                        }

                        jaw.style.transform = `translate(-50%, ${volume}px)`;
                        // jaw.classList.add('active');
                        
                        // console.log('partition: ', partition);
                        dividend = +partition/12;
                        for (let i = 0; i < jawCopies.length; i++) {
                            let x = dividend;
                            // console.log(x);
                            requestAnimationFrame(function () {
                                var j = i;
                                var y = x;
                                jawCopies[j].style.transform = `translate(-49.7%, ${y - 9}px)`;
                            });
                            
                            dividend = dividend + partition/12;
                            
                        }
                        // } else {
                        //     jaw.classList.remove('active');
                        // for (let i = 0; i < jawCopies.length; i++) {
                        //     jawCopies[i].classList.remove('active');
                        // }
                    


                    // }
                    // slowMeter.value = slowValueDisplay.innerText =
                    //     soundMeter.slow.toFixed(2);
                    // clipMeter.value = clipValueDisplay.innerText =
                    //     soundMeter.clip;
                }, 150);
            });
        }

        function handleError(error) {
            console.log('navigator.getUserMedia error: ', error);
        }

        navigator.mediaDevices.getUserMedia(constraints).
            then(handleSuccess).catch(handleError);

    </script>

</body>

</html>